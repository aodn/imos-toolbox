#summary Specification of the Toolbox's internal Matlab data structures.
#labels Specification

<wiki:toc max_depth="3"/>

= Toolbox Data Structures =

Data from one deployment is passed around the Toolbox in a matlab struct called `sample_data`. This struct contains all of the data and metadata associated with a deployment; it is more or less in the same structure as the resulting NetCDF file.

The `sample_data` struct originates in the [ParserSpecification Parser] module, when the input data is first loaded. When data from multiple deployments are passed around, they are passed in a cell array.

The following sections define scalar instances of `sample_data` structs.

== sample_data ==

`sample_data` is a scalar struct which contain sample data/metadata. The most important fields are listed below. Global NetCDF attributes are added as fields of `sample_data`; coordinate variable attributes are added as fields of each `dimensions` entry; variable attributes are added as fields of each `variables` entry.

 * `sample_data`: struct
   * `meta`: Any metadata which is not to be exported to NetCDF.
     * `FieldTrip`: Associated field trip entry from the deployment database
     * `DeploymentData`: Associated deployment entry from the deployment database
     * `Sites`:  Associated site entry from the deployment database
     * `Instruments`: Associated instrument entry from the deployment database
     * `level`: Data process level (Numeric)
     * `log`: Cell array of strings forming a log of the processing which has occurred on the data.
   * `dimensions`: Cell array of structs:
     * `name`: IMOS compliant dimension name (String)
     * `data`: Vector of dimension data (Numeric)
     * `flags`: Vector of flag data (byte/char - see below)
   * `variables`: Cell array of structs:
     * `name`: IMOS compliant parameter name (String)
     * `dimensions`: Vector of indices into the `dimensions` array (Numeric)
     * `data`: Vector/matrix of data (Numeric)
     * `flags`: Vector/matrix of flags (byte/char - see below)

=== Notes ===

 * It is assumed that time is always the first element of the `dimensions` array, the first element of every `variables.dimensions` vector, and the first dimension of the `variables.data` matrices. This implies that single dimensional data must be stored as column vectors.
 * The `variables.dimensions` array must be in the same order as the `variables.data` matrix indices.
 * Automatic and manual QC procedures should add to the log array when they modify any data.

=== Flagged data ===

The `flags` field in the `variables` and `dimensions` structs refers to data which has been flagged (either automatically or manually) as having some kind of problem (e.g. out of range). A single flag value is proivided for every element in the `data` matrix.

The flag values are defined in Section 6.2 of the IMOS NetCDF User's Manual. The type and meaning of flag values differ depending on the Quality Control Set in use.

== Relationship ==

A `sample_data` struct contains data corresponding to one physical instrument, e.g. an SBE37. One instrument may have multiple sensors; each element in the `variables` array corresponds to one sensor.

A `sample_data` struct maps directly to one entry in the !FieldTrip table in the [DeploymentDatabase DDB], and one entry in the !DeploymentData table. There will likely be multiple instruments per field trip, so multiple `sample_data` structs may map to the same field trip. These structs may be passed around within the toolbox as a cell array. 

http://imos-toolbox.googlecode.com/svn/wiki/images/data_structure_relationship.png